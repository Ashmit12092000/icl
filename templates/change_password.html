
{% extends "base.html" %}

{% block title %}Change Password{% endblock %}

{% block content %}
<div class="max-w-md mx-auto bg-gray-800 rounded-lg shadow-lg p-6">
    <div class="text-center mb-6">
        <div class="mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-indigo-600 mb-4">
            <i class="fas fa-key text-white text-xl"></i>
        </div>
        <h2 class="text-2xl font-bold text-white">Change Password</h2>
        <p class="text-gray-300 mt-2">Update your account password</p>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="mb-4 rounded-lg p-4 {% if category == 'error' %}bg-red-900/50 text-red-200 border border-red-700/50{% else %}bg-green-900/50 text-green-200 border border-green-700/50{% endif %}">
                    <div class="flex items-center">
                        <i class="fas fa-{% if category == 'error' %}exclamation-triangle{% else %}check-circle{% endif %} mr-2"></i>
                        {{ message }}
                    </div>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <form method="POST" class="space-y-4">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        
        <!-- Current Password -->
        <div>
            <label for="current_password" class="block text-sm font-medium text-gray-300 mb-2">
                Current Password *
            </label>
            <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <i class="fas fa-lock text-gray-400"></i>
                </div>
                <input type="password" id="current_password" name="current_password" required
                       class="block w-full pl-10 pr-3 py-2 border border-gray-600 rounded-lg bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                       placeholder="Enter current password">
            </div>
        </div>

        <!-- New Password -->
        <div>
            <label for="new_password" class="block text-sm font-medium text-gray-300 mb-2">
                New Password *
            </label>
            <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <i class="fas fa-key text-gray-400"></i>
                </div>
                <input type="password" id="new_password" name="new_password" required minlength="6"
                       class="block w-full pl-10 pr-3 py-2 border border-gray-600 rounded-lg bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                       placeholder="Enter new password">
            </div>
            <p class="text-xs text-gray-400 mt-1">Password must be at least 6 characters long</p>
        </div>

        <!-- Confirm New Password -->
        <div>
            <label for="confirm_password" class="block text-sm font-medium text-gray-300 mb-2">
                Confirm New Password *
            </label>
            <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <i class="fas fa-check text-gray-400"></i>
                </div>
                <input type="password" id="confirm_password" name="confirm_password" required minlength="6"
                       class="block w-full pl-10 pr-3 py-2 border border-gray-600 rounded-lg bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                       placeholder="Confirm new password">
            </div>
        </div>

        <!-- Buttons -->
        <div class="flex space-x-3 pt-4">
            <button type="submit" 
                    class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-200">
                <i class="fas fa-save mr-2"></i>
                Change Password
            </button>
            <a href="{{ url_for('main.dashboard') }}" 
               class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-gray-500 transition duration-200">
                <i class="fas fa-times mr-2"></i>
                Cancel
            </a>
        </div>
    </form>
</div>

<script>
// Add real-time password confirmation validation
document.getElementById('confirm_password').addEventListener('input', function() {
    const newPassword = document.getElementById('new_password').value;
    const confirmPassword = this.value;
    
    if (confirmPassword && newPassword !== confirmPassword) {
        this.setCustomValidity('Passwords do not match');
    } else {
        this.setCustomValidity('');
    }
});

document.getElementById('new_password').addEventListener('input', function() {
    const confirmPassword = document.getElementById('confirm_password');
    if (confirmPassword.value) {
        confirmPassword.dispatchEvent(new Event('input'));
    }
});
</script>
{% endblock %}
